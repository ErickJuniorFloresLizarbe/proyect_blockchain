<div class="space-y-6">
    <!-- Encabezado con título y buscador -->
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <h2 class="text-xl font-bold text-gray-900 dark:text-white">Historial de Transacciones</h2>

        <!-- Buscador -->
        <div class="relative">
            <input type="text" placeholder="Buscar por dirección o hash..." (input)="search($event)"
                class="w-full md:w-64 pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
            </div>
        </div>
    </div>

    <!-- Tarjeta principal -->
    <div
        class="bg-white dark:bg-gray-800 shadow-lg rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div class="px-4 py-5 sm:px-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
                <h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Transacciones Recientes</h3>
                <p class="mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400">
                    Historial de transacciones de tu wallet en la red {{ currentNetwork }}
                </p>
            </div>

            <!-- Filtros y botón de refrescar -->
            <div class="flex flex-wrap gap-2">
                <!-- Botón de refrescar -->
                <button (click)="refreshTransactions()" [disabled]="isLoading"
                    class="inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    <svg *ngIf="!isLoading" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                    <svg *ngIf="isLoading" class="animate-spin h-4 w-4 mr-1" xmlns="http://www.w3.org/2000/svg"
                        fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4">
                        </circle>
                        <path class="opacity-75" fill="currentColor"
                            d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                        </path>
                    </svg>
                    {{ isLoading ? 'Cargando...' : 'Refrescar' }}
                </button>

                <!-- Filtros -->
                <button (click)="filterTransactions('all')" [ngClass]="{
            'bg-blue-600 text-white': currentFilter === 'all',
            'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300': currentFilter !== 'all'
          }" class="px-3 py-1.5 rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Todas
                </button>
                <button (click)="filterTransactions('sent')" [ngClass]="{
            'bg-blue-600 text-white': currentFilter === 'sent',
            'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300': currentFilter !== 'sent'
          }" class="px-3 py-1.5 rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Enviadas
                </button>
                <button (click)="filterTransactions('received')" [ngClass]="{
            'bg-blue-600 text-white': currentFilter === 'received',
            'bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300': currentFilter !== 'received'
          }" class="px-3 py-1.5 rounded-md text-sm font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                    Recibidas
                </button>
            </div>
        </div>

        <!-- Estado de carga -->
        <div *ngIf="isLoading" class="flex justify-center items-center py-10">
            <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
        </div>

        <!-- Lista de transacciones -->
        <div *ngIf="!isLoading" class="border-t border-gray-200 dark:border-gray-700">
            <!-- Mensaje cuando no hay transacciones -->
            <div *ngIf="filteredTransactions.length === 0"
                class="px-4 py-10 text-center text-gray-500 dark:text-gray-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                <p class="mt-2 text-lg font-medium">No se encontraron transacciones</p>
                <p class="mt-1">Realiza una transacción o ajusta los filtros de búsqueda</p>
            </div>

            <!-- Lista de transacciones -->
            <ul *ngIf="filteredTransactions.length > 0" class="divide-y divide-gray-200 dark:divide-gray-700">
                <li *ngFor="let tx of filteredTransactions"
                    class="hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer"
                    (click)="toggleTransactionDetails(tx.id)">

                    <!-- Resumen de la transacción -->
                    <div class="px-4 py-4 sm:px-6 flex items-center justify-between">
                        <div class="flex items-center">
                            <!-- Icono de tipo de transacción -->
                            <div class="flex-shrink-0 h-10 w-10 rounded-full flex items-center justify-center"
                                [ngClass]="{
                                  'bg-green-100 dark:bg-green-900': tx.type === 'received',
                                  'bg-red-100 dark:bg-red-900': tx.type === 'sent'
                                }">
                                <svg *ngIf="tx.type === 'received'" class="h-6 w-6 text-green-600 dark:text-green-400"
                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
                                </svg>
                                <svg *ngIf="tx.type === 'sent'" class="h-6 w-6 text-red-600 dark:text-red-400"
                                    fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M17 8l4 4m0 0l-4 4m4-4H3" />
                                </svg>
                            </div>

                            <!-- Información de la transacción -->
                            <div class="ml-4">
                                <div class="flex items-center">
                                    <div class="text-sm font-medium text-gray-900 dark:text-white">
                                        {{ tx.type === 'received' ? 'Recibido' : 'Enviado' }}
                                    </div>
                                    <span class="ml-2 px-2 inline-flex text-xs leading-5 font-semibold rounded-full"
                                        [ngClass]="{
                                          'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200': tx.status === 'completed',
                                          'bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200': tx.status === 'pending',
                                          'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200': tx.status === 'failed'
                                        }">
                                        {{ tx.status === 'completed' ? 'Completado' : tx.status === 'pending' ?
                                        'Pendiente' : 'Fallido' }}
                                    </span>
                                </div>
                                <div class="text-sm text-gray-500 dark:text-gray-400">
                                    {{ formatAddress(tx.address) }}
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                    {{ tx.timestamp | date:'medium' }}
                                </div>
                            </div>
                        </div>

                        <!-- Monto y flecha de expansión -->
                        <div class="flex flex-col items-end">
                            <div class="text-sm font-medium" [ngClass]="{
                'text-green-600 dark:text-green-400': tx.type === 'received',
                'text-red-600 dark:text-red-400': tx.type === 'sent'
              }">
                                {{ tx.type === 'received' ? '+' : '-' }}{{ tx.amount }} ETH
                            </div>
                            <div class="mt-1">
                                <svg xmlns="http://www.w3.org/2000/svg"
                                    class="h-5 w-5 text-gray-400 transition-transform duration-200"
                                    [ngClass]="{'transform rotate-180': showTransactionDetails === tx.id}" fill="none"
                                    viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- Detalles expandibles de la transacción -->
                    <div *ngIf="showTransactionDetails === tx.id" [id]="'tx-details-' + tx.id"
                        class="px-4 py-4 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600 animate-fadeIn">
                        <div class="space-y-3">
                            <!-- Hash de la transacción -->
                            <div>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Hash de la transacción:</p>
                                <div class="flex items-center">
                                    <p
                                        class="text-xs font-mono bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-600 break-all flex-grow">
                                        {{ tx.hash }}
                                    </p>
                                    <div class="flex ml-2 space-x-1">
                                        <button (click)="copyTransactionHash(tx.hash, $event)"
                                            class="p-1.5 rounded-md text-gray-500 hover:text-blue-500 hover:bg-gray-100 dark:hover:bg-gray-600"
                                            title="Copiar hash">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                            </svg>
                                        </button>
                                        <button (click)="viewOnEtherscan(tx.hash, $event)"
                                            class="p-1.5 rounded-md text-gray-500 hover:text-blue-500 hover:bg-gray-100 dark:hover:bg-gray-600"
                                            title="Ver en Etherscan">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                                viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Dirección completa -->
                            <div>
                                <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">
                                    {{ tx.type === 'sent' ? 'Dirección del destinatario:' : 'Dirección del remitente:'
                                    }}
                                </p>
                                <p
                                    class="text-xs font-mono bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-600 break-all">
                                    {{ tx.address }}
                                </p>
                            </div>

                            <!-- Nota (si existe) -->
                            <div *ngIf="tx.note">
                                <p class="text-xs text-gray-500 dark:text-gray-400 mb-1">Nota:</p>
                                <p
                                    class="text-sm bg-white dark:bg-gray-800 p-2 rounded border border-gray-200 dark:border-gray-600">
                                    {{ tx.note }}
                                </p>
                            </div>

                            <!-- Enlace a Etherscan -->
                            <div class="flex justify-end mt-2">
                                <a [href]="'https://etherscan.io/tx/' + tx.hash" target="_blank"
                                    class="text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 flex items-center"
                                    (click)="$event.stopPropagation()">
                                    Ver detalles completos en Etherscan
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 ml-1" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>